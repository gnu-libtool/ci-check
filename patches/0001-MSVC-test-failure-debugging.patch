From a3ccd81d1236b5aa1ab973ebce92d9b0dad50e93 Mon Sep 17 00:00:00 2001
From: Ileana Dumitrescu <ileanadumitrescu95@gmail.com>
Date: Mon, 31 Mar 2025 21:06:33 +0300
Subject: [PATCH] MSVC test failure debugging

---
 build-aux/ltmain.in | 2 ++
 tests/lt_dlexit.at  | 6 +++---
 tests/shlibpath.at  | 6 +++---
 3 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/build-aux/ltmain.in b/build-aux/ltmain.in
index aaf48f14..f447513a 100644
--- a/build-aux/ltmain.in
+++ b/build-aux/ltmain.in
@@ -8898,6 +8898,8 @@ func_mode_link ()
 	tool_oldlib=$func_to_tool_file_result
 	eval cmds=\"$old_archive_cmds\"
 
+	func_verbose "cmds=$cmds old_archive_cmds=$old_archive_cmds oldlib=$oldlib tool_oldlib=$tool_oldlib oldobjs=$oldobjs"
+
 	func_len " $cmds"
 	len=$func_len_result
 	if test "$len" -lt "$max_cmd_len" || test "$max_cmd_len" -le -1; then
diff --git a/tests/lt_dlexit.at b/tests/lt_dlexit.at
index 19adeec4..9c14e9a7 100644
--- a/tests/lt_dlexit.at
+++ b/tests/lt_dlexit.at
@@ -147,14 +147,14 @@ for file in a1 b1; do
   $LIBTOOL --mode=compile $CC $CPPFLAGS $CFLAGS -c $file.c
 done
 $CC $CPPFLAGS $CFLAGS -c main.c
-AT_CHECK([$LIBTOOL --mode=link $CC $CFLAGS $LDFLAGS -o liba1.la a1.lo \
+AT_CHECK([$LIBTOOL --mode=link --verbose $CC $CFLAGS $LDFLAGS -o liba1.la a1.lo \
           -rpath /foo -avoid-version], [], [ignore], [ignore])
-AT_CHECK([$LIBTOOL --mode=link $CC $CFLAGS $LDFLAGS -o modb1.la b1.lo \
+AT_CHECK([$LIBTOOL --mode=link --verbose $CC $CFLAGS $LDFLAGS -o modb1.la b1.lo \
           -rpath /foo -module -avoid-version liba1.la], [], [ignore], [ignore])
 
 # TODO: test -dlpreopen
 for dlopen in -dlopen; do
-  AT_CHECK([$LIBTOOL --mode=link $CC $CFLAGS $LDFLAGS -o main$EXEEXT main.$OBJEXT \
+  AT_CHECK([$LIBTOOL --mode=link --verbose $CC $CFLAGS $LDFLAGS -o main$EXEEXT main.$OBJEXT \
            $dlopen modb1.la $LIBLTDL], [], [ignore], [ignore])
   LT_AT_NOINST_EXEC_CHECK([./main], [-dlopen modb1.la])
 done
diff --git a/tests/shlibpath.at b/tests/shlibpath.at
index 6984cb61..d035bc88 100644
--- a/tests/shlibpath.at
+++ b/tests/shlibpath.at
@@ -27,15 +27,15 @@ mkdir sub sub/lib sub/bin
 echo 'int a () { return 0; }' > a.c
 echo 'extern int a (); int main () { return a(); }' > m.c
 $LIBTOOL --mode=compile $CC $CPPFLAGS $CFLAGS -c a.c
-$LIBTOOL --mode=link $CC $CFLAGS $LDFLAGS -o liba.la a.lo -rpath `pwd`/sub/lib
+$LIBTOOL --mode=link --verbose $CC $CFLAGS $LDFLAGS -o liba.la a.lo -rpath `pwd`/sub/lib
 $LIBTOOL --mode=install cp liba.la `pwd`/sub/lib/liba.la
 $LIBTOOL --mode=clean rm -f liba.la
 rm -f sub/lib/liba.la
 
 $CC $CPPFLAGS $CFLAGS -c m.c
-AT_CHECK([$LIBTOOL --mode=link $CC $CFLAGS $LDFLAGS -o m$EXEEXT m.$OBJEXT -Lsub/lib -la -R`pwd`/sub/lib],
+AT_CHECK([$LIBTOOL --mode=link --verbose $CC $CFLAGS $LDFLAGS -o m$EXEEXT m.$OBJEXT -Lsub/lib -la -R`pwd`/sub/lib],
          [], [ignore], [ignore])
-AT_CHECK([$LIBTOOL --mode=link $CC $CFLAGS $LDFLAGS -o m2$EXEEXT m.$OBJEXT -Lsub/lib -la],
+AT_CHECK([$LIBTOOL --mode=link --verbose $CC $CFLAGS $LDFLAGS -o m2$EXEEXT m.$OBJEXT -Lsub/lib -la],
          [], [ignore], [ignore])
 
 LT_AT_MVDIR([sub], [moved])
-- 
2.45.2

